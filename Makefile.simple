# Simple Makefile for simple-logout-all branch

.PHONY: help install dev server frontend dev-docker clean

help:
	@echo "=== Simple Logout-All (Netflix-Style) ==="
	@echo ""
	@echo "Development (Local):"
	@echo "  make install         - Install all dependencies"
	@echo "  make dev-server      - Start backend (index-simple.ts)"
	@echo "  make dev-frontend    - Start frontend in dev mode"
	@echo "  make dev             - Start both (run in separate terminals)"
	@echo ""
	@echo "Docker:"
	@echo "  make dev-docker      - Start full stack with Docker"
	@echo "  make docker-logs     - View Docker logs"
	@echo "  make docker-stop     - Stop Docker environment"
	@echo ""
	@echo "Utilities:"
	@echo "  make clean           - Remove node_modules and build artifacts"
	@echo "  make health          - Check server health"
	@echo ""
	@echo "URLs (when running):"
	@echo "  Frontend: http://localhost:5173"
	@echo "  Backend:  http://localhost:3001"
	@echo "  Health:   http://localhost:3001/health"
	@echo ""

install:
	@echo "ğŸ“¦ Installing dependencies..."
	cd server && bun install
	cd frontend && npm install
	@echo "âœ… Done"

dev-server:
	@echo "ğŸš€ Starting backend (Simple mode)..."
	cd server && bun run index-simple.ts

dev-frontend:
	@echo "ğŸ¨ Starting frontend..."
	cd frontend && npm run dev

dev:
	@echo "ğŸ“ Run these in separate terminals:"
	@echo "  Terminal 1: make dev-server"
	@echo "  Terminal 2: make dev-frontend"

dev-docker:
	@echo "ğŸ³ Starting with Docker..."
	docker-compose -f server/docker-compose.dev.yml up -d
	@echo "âœ… Services starting..."
	@echo "   Frontend: http://localhost:3000"
	@echo "   Backend:  http://localhost:3001"
	@echo "   Nginx:    http://localhost:80"

docker-logs:
	docker-compose -f server/docker-compose.dev.yml logs -f

docker-stop:
	docker-compose -f server/docker-compose.dev.yml down

health:
	@echo "ğŸ¥ Checking server health..."
	curl -s http://localhost:3001/health | jq . 2>/dev/null || curl -s http://localhost:3001/health || echo "Server not responding"

clean:
	@echo "ğŸ—‘ï¸  Cleaning..."
	rm -rf server/node_modules
	rm -rf frontend/node_modules
	rm -rf frontend/dist
	@echo "âœ… Clean complete"

.DEFAULT_GOAL := help
